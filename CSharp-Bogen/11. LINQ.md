# LINQ

LINQ (Language Integrated Query) er en kraftfuld del af C#, der gør det nemt at forespørge og manipulere data i samlinger som lister, arrays og dictionaries. I stedet for at skrive lange loops kan du med LINQ skrive korte, læsbare forespørgsler – næsten som at stille spørgsmål til dine data.

[Officiel dokumentation - LINQ](https://learn.microsoft.com/en-us/dotnet/csharp/linq/)

## Hvad er LINQ?

LINQ låner syntaks fra databaser (SQL) og bringer den ind i C#. Du kan filtrere, sortere, gruppere og transformere data uden at skrive mange `foreach`-loops. LINQ arbejder med alt, der implementerer `IEnumerable<T>` – herunder `List<T>`, `int[]`, `Dictionary` og mange andre.

For at bruge LINQ skal du tilføje:

```csharp
using System.Linq;
```

## Metode-syntaks vs. Query-syntaks

LINQ kan skrives på to måder. **Metode-syntaks** er den mest brugte i praksis og bygger på metoder som `.Where()`, `.Select()` og `.OrderBy()`. **Query-syntaks** ligner SQL og bruges mindre. Vi fokuserer på metode-syntaks her.

**Samme resultat – to måder:**

```csharp
var numbers = new List<int> { 1, 2, 3, 4, 5, 6 };

// Metode-syntaks (anbefales)
var evenNumbers = numbers.Where(x => x % 2 == 0).ToList();

// Query-syntaks
var evenNumbersQuery = (from n in numbers where n % 2 == 0 select n).ToList();
```

## Lambda-udtryk (x => ...)

LINQ bruger ofte **lambda-udtryk** til at beskrive, hvad der skal ske med hvert element. Syntaksen er:

```
parameter => udtryk
```

`x` er et element i samlingen, og til højre for `=>` står logikken. Du kan læse `x => x % 2 == 0` som "for hvert x, returner true hvis x er lige".

```csharp
// x er hvert tal i listen
numbers.Where(x => x % 2 == 0)

// name er hvert navn i listen
names.Where(name => name.Length > 3)

// person er hvert objekt – vi tilgår properties
people.Where(person => person.Age >= 18)
```

## De vigtigste LINQ-metoder

### Where – filtrering

`.Where()` bruges til at filtrere elementer ud fra en betingelse. Kun elementer, der opfylder betingelsen, kommer med i resultatet.

```csharp
var numbers = new List<int> { 1, 2, 3, 4, 5, 6, 7, 8, 9, 10 };

// Kun lige tal
var evenNumbers = numbers.Where(x => x % 2 == 0).ToList();
// Resultat: 2, 4, 6, 8, 10

// Tal større end 5
var bigNumbers = numbers.Where(x => x > 5).ToList();
// Resultat: 6, 7, 8, 9, 10

// Med objekter
var people = new List<Person>
{
    new Person { Name = "Alice", Age = 25 },
    new Person { Name = "Bob", Age = 17 },
    new Person { Name = "Charlie", Age = 30 }
};

var adults = people.Where(p => p.Age >= 18).ToList();
```

### Select – transformation

`.Select()` transformerer hvert element til noget andet. Du ændrer ikke de oprindelige data, men laver en ny samling.

```csharp
var numbers = new List<int> { 1, 2, 3, 4, 5 };

// Dobbelt hvert tal
var doubled = numbers.Select(x => x * 2).ToList();
// Resultat: 2, 4, 6, 8, 10

// Konverter til streng
var asStrings = numbers.Select(x => x.ToString()).ToList();

// Vælg kun et felt fra objekter
var names = people.Select(p => p.Name).ToList();
// Resultat: "Alice", "Bob", "Charlie"

// Lav anonyme objekter
var summary = people.Select(p => new { p.Name, p.Age }).ToList();
```

### OrderBy / OrderByDescending – sortering

`.OrderBy()` sorterer stigende, `.OrderByDescending()` sorterer faldende.

```csharp
var numbers = new List<int> { 5, 2, 8, 1, 9 };

var ascending = numbers.OrderBy(x => x).ToList();
// Resultat: 1, 2, 5, 8, 9

var descending = numbers.OrderByDescending(x => x).ToList();
// Resultat: 9, 8, 5, 2, 1

// Sorter personer efter alder
var byAge = people.OrderBy(p => p.Age).ToList();

// Sorter efter navn (alfabetisk)
var byName = people.OrderBy(p => p.Name).ToList();
```

### First / FirstOrDefault

- `.First()`: returnerer det første element; kaster fejl, hvis listen er tom.
- `.FirstOrDefault()`: returnerer det første element eller standardværdien (fx `null` for referencetyper, 0 for int), hvis listen er tom.

```csharp
var numbers = new List<int> { 10, 20, 30 };

int first = numbers.First();
// Resultat: 10

int firstEven = numbers.Where(x => x % 2 == 0).First();
// Resultat: 10

// Med FirstOrDefault – sikrere ved tomme resultater
int maybeNull = numbers.Where(x => x > 100).FirstOrDefault();
// Resultat: 0 (standardværdi for int)
```

### Count – antal elementer

```csharp
var numbers = new List<int> { 1, 2, 3, 4, 5 };

int total = numbers.Count();
// Resultat: 5

int evenCount = numbers.Count(x => x % 2 == 0);
// Resultat: 2
```

### Any / All

- `.Any()`: er der mindst ét element (evt. der opfylder en betingelse)?
- `.All()`: opfylder alle elementer betingelsen?

```csharp
var numbers = new List<int> { 1, 2, 3, 4, 5 };

bool hasElements = numbers.Any();
// Resultat: true

bool hasEven = numbers.Any(x => x % 2 == 0);
// Resultat: true

bool allPositive = numbers.All(x => x > 0);
// Resultat: true
```

### Sum, Min, Max, Average

```csharp
var numbers = new List<int> { 1, 2, 3, 4, 5 };

int sum = numbers.Sum();
// Resultat: 15

int min = numbers.Min();
int max = numbers.Max();
double avg = numbers.Average();
```

## Sammenkædning af metoder

LINQ-metoder kan kædes sammen. Resultatet af én metode sendes videre til den næste.

```csharp
var numbers = new List<int> { 1, 2, 3, 4, 5, 6, 7, 8, 9, 10 };

// Find lige tal, gange med 10, sorter faldende, tag de tre første
var result = numbers
    .Where(x => x % 2 == 0)
    .Select(x => x * 10)
    .OrderByDescending(x => x)
    .Take(3)
    .ToList();
// Resultat: 100, 80, 60
```

### Take og Skip

- `.Take(n)`: tager de første n elementer.
- `.Skip(n)`: springer de første n elementer over.

```csharp
var numbers = new List<int> { 1, 2, 3, 4, 5 };

var firstThree = numbers.Take(3).ToList();
// Resultat: 1, 2, 3

var skipTwo = numbers.Skip(2).ToList();
// Resultat: 3, 4, 5
```

## Et komplet eksempel

```csharp
using System;
using System.Collections.Generic;
using System.Linq;

public class Person
{
    public string Name { get; set; }
    public int Age { get; set; }
}

class Program
{
    static void Main()
    {
        var people = new List<Person>
        {
            new Person { Name = "Alice", Age = 25 },
            new Person { Name = "Bob", Age = 17 },
            new Person { Name = "Charlie", Age = 30 },
            new Person { Name = "Diana", Age = 22 }
        };

        // Find voksne, sorter efter alder, hent navnene
        var adultNames = people
            .Where(p => p.Age >= 18)
            .OrderBy(p => p.Age)
            .Select(p => p.Name)
            .ToList();

        foreach (var name in adultNames)
        {
            Console.WriteLine(name);
        }
        // Udskriver: Diana, Alice, Charlie
    }
}
```

## ToList() og execution

LINQ-metoder som `Where` og `Select` returnerer ofte en `IEnumerable`, som kun bliver beregnet, når du bruger resultatet (f.eks. i en `foreach` eller ved `.ToList()`). `.ToList()` tvinger beregningen og giver en `List<T>`, som du kan gemme og bruge flere gange.

```csharp
// Uden ToList() – beregnes hver gang du itererer
var query = numbers.Where(x => x > 5);

// Med ToList() – beregnes én gang og gemmes som liste
var list = numbers.Where(x => x > 5).ToList();
```

## Opsummering

| Metode | Formål |
|--------|--------|
| `Where()` | Filtrer elementer |
| `Select()` | Transformer elementer |
| `OrderBy()` / `OrderByDescending()` | Sorter |
| `First()` / `FirstOrDefault()` | Få første element |
| `Count()` | Tæl elementer |
| `Any()` / `All()` | Tjek betingelser |
| `Sum()`, `Min()`, `Max()`, `Average()` | Aggregering |
| `Take()` / `Skip()` | Paginering |

LINQ gør koden kortere, læsbarere og lettere at vedligeholde. Når du er vant til `Where`, `Select` og de andre metoder, vil du ofte foretrække LINQ frem for lange loops.

---
## Mere information

**C# for Beginners (Microsoft)**  
![LINQ and IEnumerable [Pt 15]](https://www.youtube.com/watch?v=4ro5UCqU0P4)  
[LINQ Query Expressions From, Where, Orderby, and Select [Pt 16]](https://learn.microsoft.com/en-us/shows/csharp-for-beginners/linq-query-expressions-from-where-orderby-and-select-csharp-for-beginners/) · [LINQ Method Syntax vs Query [Pt 17]](https://learn.microsoft.com/en-us/shows/csharp-for-beginners/linq-method-syntax-vs-query-csharp-for-beginners/)  
*[Hele serien (19 afsnit)](https://www.youtube.com/playlist?list=PLdo4fOcmZ0oULFjxrOagaERVAMbmG20Xe)*

*Tilføj gerne flere videoer og ressourcer her.*

---

**Se også:** Eksempelkode i `Teori/LINQExample.cs` i projektmappen.
